<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Bilan annuel de destinée</title>
    <script src="https://google-apps-script.googleusercontent.com/apis/script/ap"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }



        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: #F9F2F2;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #FCFBFB;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(123, 29, 34, 0.1);
        }

        h1 {
            text-align: center;
            color: #7B1D22;
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background: #F9F2F2;
        }

        h2 {
            color: #B42424;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #BC2C34;
        }

        h3 {
            color: #7B1D22;
            margin-bottom: 15px;
        }

        .user-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #7B1D22;
            font-weight: bold;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #BC2C34;
            border-radius: 5px;
            font-size: 0.95em;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #BC2C34;
            border-radius: 5px;
            margin-bottom: 15px;
            resize: vertical;
            min-height: 200px;
            font-family: inherit;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .rating {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
        }

        .rating label {
            margin-right: 10px;
            min-width: 200px;
            color: #7B1D22;
        }

        .rating input[type="range"] {
            flex: 1;
            accent-color: #BC2C34;
        }

        .rating-value {
            position: absolute;
            right: -40px;
            color: #7B1D22;
            font-weight: bold;
        }

        .submit-btn {
            display: block;
            width: 200px;
            margin: 30px auto;
            padding: 12px;
            background: #BC2C34;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 1.1em;
        }

        .submit-btn:hover {
            background: #7B1D22;
        }

        .required {
            color: #B42424;
            margin-left: 3px;
        }

        .subsection {
            margin-bottom: 25px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            margin-right: 20px;

        }

        .progress-container {
            width: 100%;
            margin: 15px 0;
        }

        progress {
            width: 100%;
            height: 25px;
            border-radius: 5px;
            background: #f0f0f0;
        }

        progress::-webkit-progress-bar {
            background: #f0f0f0;
            border-radius: 5px;
        }

        progress::-webkit-progress-value {
            background: #BC2C34;
            border-radius: 5px;
        }

        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #BC2C34;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.95em;
        }

        .percentage-value {
            text-align: center;
            color: #7B1D22;
            font-weight: bold;
            margin-top: 5px;
        }

        .faith-progress {
            margin: 20px 0;
        }

        .percentage-choices {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .percentage-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .percentage-option input[type="radio"] {
            margin: 0;
        }

        .percentage-option label {
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .section {
                padding: 15px;
            }

            .rating {
                flex-direction: column;
                align-items: flex-start;
            }

            .rating label {
                margin-bottom: 5px;
            }

            .rating-value {
                position: static;
                margin-top: 5px;
            }

            .radio-group {
                flex-direction: column;
                gap: 10px;
            }

            textarea {
                min-height: 150px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Bilan annuel de destinée</h1>
        <form id="evaluationForm">

            <!-- Informations utilisateur -->
            <div class="section">
                <h2>Informations Personnelles</h2>
                <div class="user-info">
                    <div class="input-group">
                        <label>Nom<span class="required">*</span></label>
                        <input type="text" id="nom" required>
                    </div>
                    <div class="input-group">
                        <label>Prénom<span class="required">*</span></label>
                        <input type="text" id="prenom" required>
                    </div>
                    <div class="input-group">
                        <label>Téléphone<span class="required">*</span></label>
                        <input type="tel" id="telephone" required pattern="[0-9]{8,}"
                            title="Veuillez entrer un numéro de téléphone valide">
                    </div>
                </div>
            </div>

            <!-- Section 1: Croissance Spirituelle -->
            <div class="section">
                <h2>1. Croissance Spirituelle</h2>

                <div class="subsection">
                    <h3 id="ma-foi-title">Ma foi dans ma communauté chrétienne</h3>
                    <div class="input-group">
                        <label>Évolution de ma foi en 2024<span class="required">*</span></label>
                        <div class="percentage-choices">
                            <div class="percentage-option">
                                <input type="radio" name="faith-progress" value="10" id="faith10">
                                <label for="faith10">10%</label>
                            </div>
                            <div class="percentage-option">
                                <input type="radio" name="faith-progress" value="30" id="faith30">
                                <label for="faith30">30%</label>
                            </div>
                            <div class="percentage-option">
                                <input type="radio" name="faith-progress" value="50" id="faith50">
                                <label for="faith50">50%</label>
                            </div>
                            <div class="percentage-option">
                                <input type="radio" name="faith-progress" value="70" id="faith70">
                                <label for="faith70">70%</label>
                            </div>
                            <div class="percentage-option">
                                <input type="radio" name="faith-progress" value="90" id="faith90">
                                <label for="faith90">90%</label>
                            </div>
                            <div class="percentage-option">
                                <input type="radio" name="faith-progress" value="100" id="faith100">
                                <label for="faith100">100%</label>
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>À quel pourcentage étiez-vous au début de l'année?<span class="required">*</span></label>
                        <div class="percentage-choices" id="debut-annee">
                            <div class="percentage-option">
                                <input type="radio" name="debut-annee" value="10" id="debut10">
                                <label for="debut10">10%</label>
                            </div>
                            <div class="percentage-option">
                                <input type="radio" name="debut-annee" value="30" id="debut10">
                                <label for="debut10">30%</label>
                            </div>
                            <div class="percentage-option">
                                <input type="radio" name="debut-annee" value="50" id="debut10">
                                <label for="debut10">50%</label>
                            </div>
                            <div class="percentage-option">
                                <input type="radio" name="debut-annee" value="70" id="debut10">
                                <label for="debut10">70%</label>
                            </div>
                            <div class="percentage-option">
                                <input type="radio" name="debut-annee" value="90" id="debut10">
                                <label for="debut10">90%</label>
                            </div>
                            <div class="percentage-option">
                                <input type="radio" name="debut-annee" value="100" id="debut10">
                                <label for="debut10">100%</label>
                            </div>
                            <!-- Add other percentage options similarly -->
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Avez-vous besoin d'un encadrement spirituel pour mieux grandir ou continuer votre
                            progression en 2025?<span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="encadrement-spirituel" value="oui"> Oui</label>
                            <label><input type="radio" name="encadrement-spirituel" value="non"> Non</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Quels sont vos objectifs spirituels pour 2025?<span class="required">*</span></label>
                        <textarea name="objectifs-spirituels-2025"
                            placeholder="Citez au moins deux objectifs"></textarea>
                    </div>
                </div>

                <!-- Méditation de la Parole et Vie de prière -->
                <div class="subsection">
                    <h3>Méditation de la Parole et Vie de prière</h3>

                    <div class="input-group">
                        <label>Vous sentez-vous épanoui(e) dans votre vie de prière ?<span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="epanouissement" value="oui"> Oui</label>
                            <label><input type="radio" name="epanouissement" value="non"> Non</label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Comment évaluez-vous votre progression dans la méditation de la Parole en
                            2024 ?<span class="required">*</span></label>
                        <div class="progress-container">
                            <input type="range" min="0" max="100" value="50" class="progress" id="meditation-progress">
                            <div class="percentage-value"><span id="meditation-value">50</span>%</div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Avez-vous besoin de stratégies et de suivi dans ce domaine ?<span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="besoin-suivi" value="oui"> Oui</label>
                            <label><input type="radio" name="besoin-suivi" value="non"> Non</label>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Quels sont vos objectifs de croissance pour 2025 ?</label>
                        <textarea placeholder="Citez au moins deux objectifs"></textarea>
                    </div>
                </div>

                <!-- Engagement dans le service chrétien -->
                <div class="subsection">
                    <h3>Engagement dans le service chrétien</h3>

                    <div class="input-group">
                        <label>Dans quels ministères êtes-vous impliqué(e) ?<span class="required">*</span></label>
                        <select name="ministere" id="ministere">
                            <option value="">Sélectionnez un ministère</option>
                            <option value="enfants">Ministère des enfants</option>
                            <option value="protocole">Ministère du protocole</option>
                            <option value="technique">Ministère technique</option>
                            <option value="adoration">Ministère d'adoration et louange</option>
                            <option value="priere">Ministère de prière</option>
                            <option value="autre">Autre ministère</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Comment évaluez-vous votre niveau d'engagement actuel ?<span class="required">*</span></label>
                        <div class="progress-container">
                            <input type="range" min="0" max="100" value="50" class="progress" id="engagement-progress">
                            <div class="percentage-value"><span id="engagement-value">50</span>%</div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Quels sont vos objectifs de service pour 2025 ?</label>
                        <textarea placeholder="Écrivez au moins deux objectifs"></textarea>
                    </div>
                </div>
            </div>

            <!-- Section 2: Développement Personnel -->
            <div class="section">
                <h2>2. Développement Personnel</h2>

                <div class="subsection">
                    <h3>Objectifs de vie et vision personnelle</h3>
                    <div class="input-group">
                        <label>Est-ce que mes objectifs 2024 ont été atteints ou ont progressé?<span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="objectifs-2024" value="oui"> Oui</label>
                            <label><input type="radio" name="objectifs-2024" value="non"> Non</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Quels étaient vos objectifs principaux cette année?</label>
                        <textarea name="objectifs-principaux" placeholder="Citez au moins deux objectifs"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Comment votre vision personnelle s'aligne-t-elle avec la volonté de Dieu?</label>
                        <textarea name="vision-personnelle"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Y-a-t-il des ajustements à faire?<span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="ajustements" value="oui"> Oui</label>
                            <label><input type="radio" name="ajustements" value="non"> Non</label>
                        </div>
                    </div>
                </div>

                <div class="subsection">
                    <h3>Croissance professionnelle</h3>
                    <div class="input-group">
                        <label>Quelles nouvelles compétences avez-vous acquises?</label>
                        <textarea name="competences-acquises"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Quelles formations avez-vous suivies?</label>
                        <textarea name="formations-suivies"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Avez-vous lu des livres qui ont contribué à votre épanouissement?<span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="livres-lus" value="oui"> Oui</label>
                            <label><input type="radio" name="livres-lus" value="non"> Non</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Quels sont vos axes d'amélioration?</label>
                        <textarea name="axes-amelioration"></textarea>
                    </div>
                </div>

                <div class="subsection">
                    <h3>Relations interpersonnelles</h3>
                    <div class="input-group">
                        <label>Comment qualifieriez-vous vos relations familiales?<span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="relations-familiales" value="tres-bonne"> Très
                                bonne</label>
                            <label><input type="radio" name="relations-familiales" value="bonne"> Bonne</label>
                            <label><input type="radio" name="relations-familiales" value="normale"> Normale</label>
                            <label><input type="radio" name="relations-familiales" value="mauvaise"> Mauvaise</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Quelle est la qualité de vos amitiés?<span class="required">*</span></label>
                        <div class="radio-group">
                            <label><input type="radio" name="qualite-amitie" value="tres-bonne"> Très bonne</label>
                            <label><input type="radio" name="qualite-amitie" value="bonne"> Bonne</label>
                            <label><input type="radio" name="qualite-amitie" value="normale"> Normale</label>
                            <label><input type="radio" name="qualite-amitie" value="mauvaise"> Mauvaise</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Comment gérez-vous les conflits dans vos différentes relations?</label>
                        <textarea name="gestion-conflits"></textarea>
                    </div>
                </div>
            </div>

            <!-- Section 3: Réflexions et Objectifs -->
            <div class="section">
                <h2>3. Réflexions et Objectifs pour l'Avenir</h2>

                <div class="subsection">
                    <h3>Réflexions sur l'année écoulée</h3>
                    <textarea placeholder="Faites le point sur l'année :
- Quelles sont les principales leçons apprises ?
- Quels défis avez-vous surmontés ?
- Quelles bénédictions avez-vous reçues ?
- Comment avez-vous grandi spirituellement ?"></textarea>
                </div>

                <div class="subsection">
                    <h3>Objectifs pour la prochaine année<span class="required">*</span></h3>
                    <textarea placeholder="Définissez vos objectifs futurs :
- Quels sont vos objectifs spirituels précis ?
- Quelles nouvelles compétences souhaitez-vous développer ?
- Quels changements concrets voulez-vous apporter ?
- Quels ministères souhaitez-vous intégrer ?"></textarea>
                </div>
            </div>

            <button type="submit" class="submit-btn">Enregistrer le bilan</button>
        </form>
    </div>

    <script>
        // Mise à jour des valeurs de progression
        document.getElementById('meditation-progress').addEventListener('input', function () {
            document.getElementById('meditation-value').textContent = this.value;
        });

        document.getElementById('engagement-progress').addEventListener('input', function () {
            document.getElementById('engagement-value').textContent = this.value;
        });

        // Mise à jour des pourcentages en temps réel
        document.querySelectorAll('.progress-range').forEach(range => {
            range.addEventListener('input', function () {
                this.parentElement.querySelector('.rating-value').textContent = this.value + '%';
            });
        });

        document.getElementById('evaluationForm').addEventListener('submit', function (e) {
            e.preventDefault();
            submitForm();
        });

        function submitForm() {
            let isValid = true;

            // List of required radio button groups
            const requiredGroups = [
                'faith-progress',
                'debut-annee',
                'encadrement-spirituel',
                'epanouissement',
                'besoin-suivi',
                'objectifs-2024',
                'ajustements',
                'livres-lus',
                'relations-familiales',
                'qualite-amitie'
            ];

            // Validate required radio groups
            requiredGroups.forEach(groupName => {
                const inputs = document.querySelectorAll(`input[name="${groupName}"]`);
                let isAnyChecked = false;
                inputs.forEach(input => {
                    if (input.checked) {
                        isAnyChecked = true;
                    }
                });
                if (!isAnyChecked) {
                    isValid = false;
                    alert(`Veuillez sélectionner une option pour ${groupName}.`);
                }
            });

            // Validate select elements with required attribute
            const selects = document.querySelectorAll('select[required]');
            selects.forEach(select => {
                if (select.value === '') {
                    isValid = false;
                    alert(`Veuillez sélectionner une option pour ${select.name}.`);
                }
            });

            // Récupérer toutes les valeurs des textareas
            const textareas = document.querySelectorAll('textarea');

            const ranges = document.querySelectorAll('input[type="range"]');

            // Valider que chaque textarea contient au moins 50 caractères
            textareas.forEach(textarea => {
                if (textarea.value.length < 30) {
                    isValid = false;
                    textarea.style.border = '2px solid red';
                } else {
                    textarea.style.border = '1px solid #ddd';
                }
            });

            if (!isValid) {
                alert('Veuillez remplir tous les champs avec au moins 30 caractères.');
                return;
            }

            // Récupérer les valeurs des champs personnels
            const nom = document.getElementById('nom').value;
            const prenom = document.getElementById('prenom').value;
            const telephone = document.getElementById('telephone').value;

            // Préparer les données
            const formData = {
                nom: document.getElementById('nom').value,
                prenom: document.getElementById('prenom').value,
                telephone: document.getElementById('telephone').value,
                faithProgress: document.querySelector('input[name="faith-progress"]:checked').value,
                debutAnnee: document.querySelector('input[name="debut-annee"]:checked').value,
                encadrementSpirituel: document.querySelector('input[name="encadrement-spirituel"]:checked').value,
                objectifsSpirituels2025: document.querySelector('textarea[name="objectifs-spirituels-2025"]').value,
                epanouissement: document.querySelector('input[name="epanouissement"]:checked').value,
                meditationProgress: document.getElementById('meditation-progress').value,
                besoinSuivi: document.querySelector('input[name="besoin-suivi"]:checked').value,
                objectifsCroissance2025: document.querySelector('textarea[name="objectifs-croissance-2025"]').value,
                ministere: document.getElementById('ministere').value,
                engagementProgress: document.getElementById('engagement-progress').value,
                objectifsService2025: document.querySelector('textarea[name="objectifs-service-2025"]').value,
                objectifs2024: document.querySelector('input[name="objectifs-2024"]:checked').value,
                objectifsPrincipaux: document.querySelector('textarea[name="objectifs-principaux"]').value,
                visionPersonnelle: document.querySelector('textarea[name="vision-personnelle"]').value,
                ajustements: document.querySelector('input[name="ajustements"]:checked').value,
                competencesAcquises: document.querySelector('textarea[name="competences-acquises"]').value,
                formationsSuivies: document.querySelector('textarea[name="formations-suivies"]').value,
                livresLus: document.querySelector('input[name="livres-lus"]:checked').value,
                axesAmelioration: document.querySelector('textarea[name="axes-amelioration"]').value,
                relationsFamiliales: document.querySelector('input[name="relations-familiales"]:checked').value,
                qualiteAmitie: document.querySelector('input[name="qualite-amitie"]:checked').value,
                gestionConflits: document.querySelector('textarea[name="gestion-conflits"]').value,
                reflexionsAnnee: document.querySelector('textarea[name="reflexions-annee"]').value,
                objectifsFuturs: document.querySelector('textarea[name="objectifs-futurs"]').value
            };




            // Radio buttons and selects validation
            const radios = document.querySelectorAll('input[type="radio"], input[type="checkbox"], select');
            radios.forEach(radio => {
                if (!radio.checked && radio.type !== 'checkbox') {
                    if (radio.name) {
                        const radiosName = document.querySelectorAll(`input[name="${radio.name}"]`);
                        let isAnyChecked = false;
                        radiosName.forEach(r => {
                            if (r.checked) {
                                isAnyChecked = true;
                            }
                        });
                        if (!isAnyChecked) {
                            isValid = false;
                            alert(`Veuillez sélectionner une option pour ${radio.name}.`);
                        }
                    }
                }
            });

            // Désactiver le bouton pendant l'envoi
            const submitBtn = document.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Envoi en cours...';

            // Remplacer la partie google.script.run par une requête fetch
            fetch('https://script.google.com/macros/s/AKfycbwAncap897JvBTkJ3Y0EUWNUcTE4VPrz8ijTk-HG98oC9qhxrAR7s2iXOSp_dKCRIir/exec', {
                method: 'POST',
                mode: 'no-cors', // This makes the response opaque
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
                .then(response => {
                    // Don't try to parse JSON when using no-cors
                    if (response.type === 'opaque') {
                        // Assume success since we can't read the response
                        return { success: true };
                    }
                    return response.text(); // Use text() instead of json()
                })
                .then(data => {
                    alert('Votre bilan a été envoyé avec succès !');
                    document.getElementById('evaluationForm').reset();
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Enregistrer le bilan';
                })
                .catch(error => {
                    alert('Une erreur est survenue lors de l\'enregistrement. Veuillez réessayer.');
                    console.error('Error:', error);
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Enregistrer le bilan';
                });
        }

        // Ajouter des écouteurs d'événements pour la validation en temps réel
        document.querySelectorAll('textarea').forEach(textarea => {
            textarea.addEventListener('input', function () {
                if (this.value.length < 50) {
                    this.style.border = '2px solid #ffcccb';
                } else {
                    this.style.border = '1px solid #ddd';
                }
            });
        });
    </script>
</body>

</html>
